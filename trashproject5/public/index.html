<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Document</title>
<style>
body, html {
height: 100%;
margin: 0;
}

body {
display: flex;
justify-content: center; /* horizontal center */
align-items: center;     /* vertical center */
height: 100vh;           /* full viewport height */
}

#container {
/* optional styling */
border: 1px solid #ccc;
padding: 40px;
}
</style>

</head>
<body>
    
    
<div id="container">

<form id="dataflow">
<div><label>username:</label> <input id="username" type="text" required></div>
<div><label>email:</label> <input id="email" type="email" required></div>
<div><label>birthdate:</label> <input id="bdate" type="date"></div>
<div><input id="sub" type="submit"></div>

</form>
<div id="sucesspost"></div>
<div id="reqFromServer">
<input id="usersearch" type="text"><button id="btn1" onclick="getUser()">search</button>
</div>

</div>

<div>
<input id="uemail" type="text"><button id="btn2" onclick="updateUser()">update</button>
<label id="res"></label>
</div>




</body>




<script>
document.getElementById("dataflow").addEventListener("submit", async (e)=>{
e.preventDefault();
const successPost= document.getElementById("sucesspost");
const username = document.getElementById('username').value;
const email = document.getElementById('email').value;

const bdate = document.getElementById("bdate").value;
const birthdate = new Date(bdate).toISOString();
const res= await fetch("http://localhost:3000/api/users/",
{
method : "POST",
headers : {
"Content-Type": "application/json"
},
body : JSON.stringify({username,email,birthdate})
});

const result = await res.json();
if (res.ok){
successPost.innerHTML = `<p> ${result.username} has been added successfuly</p>`;
console.log(result);
}


});

            
async function getUser()
{
const key = document.getElementById("usersearch").value;
const render = document.getElementById("reqFromServer");
try{
const res = await fetch(`http://localhost:3000/api/users/username?username=${encodeURIComponent(key)}`);
if (!res.ok) {
const errorData = await res.json().catch(() => ({}));
throw new Error(errorData.error || `Error: ${res.status} ${res.statusText}`);
}
const result = await res.json();
render.innerHTML = `<p>${result.email}</p>`;

}catch(err){
console.log(err);

}
}
            
async function updateUser(){

const search = document.getElementById("usersearch").value;
const uemail = document.getElementById("uemail").value;
const render = document.getElementById("res");


try{
const res = await fetch(`http://localhost:3000/api/users/update?username=${encodeURIComponent(search)}`,

{
  method : "PUT",
  headers:{
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
    email : uemail,
  })
});

const result = await res.json();

if (!res.ok){
  throw new Error("error");
}

render.innerHTML = `user has been succefully updated!`;


}catch(err){
  console.error(err);
}

}

        





</script>


</html>